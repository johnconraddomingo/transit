<!DOCTYPE html>
<html>

<head>
    <title>{{ dashboard_title }}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Load CSS and JS using a robust method -->
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            // Add CSS
            const styleElement = document.createElement('style');
            styleElement.textContent = `{{ embedded_css | safe }}`;
            document.head.appendChild(styleElement);

            // Execute JavaScript
            const jsCode = `{{ embedded_js | safe }}`;
            const scriptElement = document.createElement('script');
            scriptElement.text = jsCode;
            document.body.appendChild(scriptElement);

            // Initialize charts after JS is loaded
            setTimeout(function () {
                // Look for all chart canvases and initialize them
                const chartCanvases = document.querySelectorAll('.chart-canvas');
                chartCanvases.forEach(function (canvas) {
                    try {
                        const chartData = JSON.parse(canvas.dataset.chart);
                        const chartOptions = JSON.parse(canvas.dataset.options);
                        if (typeof Chart !== 'undefined') {
                            new Chart(canvas, {
                                type: 'line',
                                data: chartData,
                                options: chartOptions
                            });
                        } else {
                            console.error('Chart library not loaded');
                        }
                    } catch (e) {
                        console.error('Error initializing chart:', e);
                    }
                });
            }, 500);
        });
    </script>
</head>

<body>
    {% include './templates/header.html' %}

    {% include './templates/executive_summary.html' %}

    {% include './templates/category_metrics.html' %}

    {% include './templates/productivity_index.html' %}

    {% include './templates/footer.html' %}
</body>

</html>